<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>utils.email_sender &#8212; blog-api-main  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=27fed22d" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for utils.email_sender</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">fastapi_mail</span><span class="w"> </span><span class="kn">import</span> <span class="n">FastMail</span><span class="p">,</span> <span class="n">MessageSchema</span><span class="p">,</span> <span class="n">ConnectionConfig</span><span class="p">,</span> <span class="n">MessageType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">logger.custom_logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_logger</span><span class="p">,</span> <span class="n">create_error_logger</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">quote</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>


<span class="n">CORS_ORIGINS</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;CORS_ORIGINS&quot;</span><span class="p">)</span>
<span class="n">LOCAL_CORS_ORIGINS</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;LOCAL_CORS_ORIGINS&quot;</span><span class="p">)</span>
<span class="n">SERVER_PORT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;SERVER_PORT&quot;</span><span class="p">,</span> <span class="s2">&quot;8080&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="get_mail_config">
<a class="viewcode-back" href="../../utils.email_sender.html#utils.email_sender.get_mail_config">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_mail_config</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ConnectionConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;„É°„Éº„É´Ë®≠ÂÆö„ÇíÂèñÂæó„Åô„Çã&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ConnectionConfig</span><span class="p">(</span>
        <span class="n">MAIL_USERNAME</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MAIL_USERNAME&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">MAIL_PASSWORD</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MAIL_PASSWORD&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">MAIL_FROM</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MAIL_FROM&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">MAIL_PORT</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MAIL_PORT&quot;</span><span class="p">,</span> <span class="s2">&quot;587&quot;</span><span class="p">)),</span>
        <span class="n">MAIL_SERVER</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MAIL_SERVER&quot;</span><span class="p">,</span> <span class="s2">&quot;smtp.gmail.com&quot;</span><span class="p">),</span>
        <span class="n">MAIL_STARTTLS</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MAIL_STARTTLS&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
        <span class="n">MAIL_SSL_TLS</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MAIL_SSL_TLS&quot;</span><span class="p">,</span> <span class="s2">&quot;False&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
        <span class="n">USE_CREDENTIALS</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">VALIDATE_CERTS</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_print_dev_mode_email</span><span class="p">(</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> \
    <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verification_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ÈñãÁô∫„É¢„Éº„ÉâÁî®„ÅÆ„Ç≥„É≥„ÇΩ„Éº„É´Âá∫Âäõ„ÇíÁµ±‰∏Ä&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;üìß </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ÂÆõÂÖà: </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;‰ª∂Âêç: </span><span class="si">{</span><span class="n">subject</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verification_url</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Á¢∫Ë™çURL: </span><span class="si">{</span><span class="n">verification_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;„É°„Éº„É´ÂÜÖÂÆπ:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_email_enabled</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;„É°„Éº„É´ÈÄÅ‰ø°„ÅåÊúâÂäπ„Åã„Å©„ÅÜ„Åã„ÇíÂà§ÂÆö&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;ENABLE_EMAIL_SENDING&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_validate_mail_config</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;„É°„Éº„É´Ë®≠ÂÆö„ÅÆÂ¶•ÂΩìÊÄß„Çí„ÉÅ„Çß„ÉÉ„ÇØ&quot;&quot;&quot;</span>
    <span class="n">mail_username</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MAIL_USERNAME&quot;</span><span class="p">)</span>
    <span class="n">mail_password</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MAIL_PASSWORD&quot;</span><span class="p">)</span>
    <span class="n">mail_from</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MAIL_FROM&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="n">mail_username</span><span class="p">,</span> <span class="n">mail_password</span><span class="p">,</span> <span class="n">mail_from</span><span class="p">])</span>


<div class="viewcode-block" id="send_verification_email">
<a class="viewcode-back" href="../../utils.email_sender.html#utils.email_sender.send_verification_email">[docs]</a>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_verification_email</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Á¢∫Ë™ç„É°„Éº„É´„ÇíÈÄÅ‰ø°„Åô„Çã&quot;&quot;&quot;</span>
    <span class="n">create_logger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;„É°„Éº„É´ÈÄÅ‰ø°ÈñãÂßã - ÂÆõÂÖà: </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2">, „Éà„Éº„ÇØ„É≥: </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">encoded_token</span> <span class="o">=</span> <span class="n">quote</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="c1"># TODO: ÈñãÁô∫Áí∞Â¢É„Åß„ÅØ127.0.0.1„Çí‰ΩøÁî®„ÄÅÊú¨Áï™Áí∞Â¢É„Åß„ÅØCORS_ORIGINS„Çí‰ΩøÁî®</span>
    <span class="k">if</span> <span class="n">LOCAL_CORS_ORIGINS</span><span class="p">:</span>
        <span class="n">verification_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;http://127.0.0.1:</span><span class="si">{</span><span class="n">SERVER_PORT</span><span class="si">}</span><span class="s2">/api/v1/verify-email?token=</span><span class="si">{</span><span class="n">encoded_token</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">verification_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CORS_ORIGINS</span><span class="si">}</span><span class="s2">/api/v1/verify-email?token=</span><span class="si">{</span><span class="n">encoded_token</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">create_logger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ÁîüÊàê„Åï„Çå„ÅüÁ¢∫Ë™çURL: </span><span class="si">{</span><span class="n">verification_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;„Åì„Çì„Å´„Å°„ÅØÔºÅ</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅÆÁ¢∫Ë™ç„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô„ÄÇ</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;‰∏ãË®ò„ÅÆ„É™„É≥„ÇØÂÖà„Çà„Çä„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂ§âÊõ¥„Åó„Å¶„ÄÅÁôªÈå≤„ÇíÂÆå‰∫Ü„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;ÂàùÊúü„Éë„Çπ„ÉØ„Éº„ÉâÔºötemp_password_123</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;‰ª•‰∏ã„ÅÆ„É™„É≥„ÇØ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verification_url</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;„Åì„ÅÆ„É™„É≥„ÇØ„ÅÆÊúâÂäπÊôÇÈñì„ÅØ24ÊôÇÈñì„Åß„Åô„ÄÇ</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Blog API „ÉÅ„Éº„É†&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_email_enabled</span><span class="p">():</span>
        <span class="n">create_logger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ÈñãÁô∫„É¢„Éº„Éâ] Á¢∫Ë™ç„É°„Éº„É´ÊÉÖÂ†±„Çí„Ç≥„É≥„ÇΩ„Éº„É´„Å´Âá∫Âäõ: </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">_print_dev_mode_email</span><span class="p">(</span>
            <span class="s2">&quot;„É°„Éº„É´ÈÄÅ‰ø°ÔºàÈñãÁô∫„É¢„Éº„ÉâÔºâ&quot;</span><span class="p">,</span>
            <span class="n">email</span><span class="p">,</span>
            <span class="s2">&quot;„Äê„Éñ„É≠„Ç∞„Çµ„Éº„Éì„ÇπÊú¨‰∫∫Á¢∫Ë™ç„Äë„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅÆÁ¢∫Ë™ç&quot;</span><span class="p">,</span>
            <span class="n">content</span><span class="p">,</span>
            <span class="n">verification_url</span>
        <span class="p">)</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_validate_mail_config</span><span class="p">():</span>
        <span class="n">create_error_logger</span><span class="p">(</span><span class="s2">&quot;„É°„Éº„É´Ë®≠ÂÆö„Åå‰∏çÂÆåÂÖ®„Åß„Åô„ÄÇÈñãÁô∫„É¢„Éº„Éâ„Åß„Ç≥„É≥„ÇΩ„Éº„É´Âá∫Âäõ„Åó„Åæ„Åô„ÄÇ&quot;</span><span class="p">)</span>
        <span class="n">_print_dev_mode_email</span><span class="p">(</span>
            <span class="s2">&quot;„É°„Éº„É´ÈÄÅ‰ø°ÔºàÈñãÁô∫„É¢„Éº„Éâ - Ë®≠ÂÆö‰∏çÂÆåÂÖ®Ôºâ&quot;</span><span class="p">,</span>
            <span class="n">email</span><span class="p">,</span>
            <span class="s2">&quot;„Äê„Éñ„É≠„Ç∞„Çµ„Éº„Éì„ÇπÊú¨‰∫∫Á¢∫Ë™ç„Äë„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅÆÁ¢∫Ë™ç&quot;</span><span class="p">,</span> 
            <span class="n">content</span><span class="p">,</span>
            <span class="n">verification_url</span>
        <span class="p">)</span>
        <span class="k">return</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="n">get_mail_config</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">conf</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;„É°„Éº„É´Ë®≠ÂÆö„ÅåÊ≠£„Åó„ÅèË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì&quot;</span><span class="p">)</span>
        <span class="c1"># „Éó„É¨„Éº„É≥„ÉÜ„Ç≠„Çπ„Éà„É°„Éº„É´</span>
        <span class="n">plain_body</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># HTML„É°„Éº„É´</span>
        <span class="n">html_body</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;!DOCTYPE html&gt;</span>
<span class="s2">&lt;html&gt;</span>
<span class="s2">&lt;head&gt;</span>
<span class="s2">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span>
<span class="s2">    &lt;title&gt;„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅÆÁ¢∫Ë™ç&lt;/title&gt;</span>
<span class="s2">&lt;/head&gt;</span>
<span class="s2">&lt;body style=&quot;font-family: Arial, sans-serif; line-height: 1.6; color: #333;&quot;&gt;</span>
<span class="s2">    &lt;div style=&quot;max-width: 600px; margin: 0 auto; padding: 20px;&quot;&gt;</span>
<span class="s2">        &lt;h2 style=&quot;color: #2c3e50;&quot;&gt;„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅÆÁ¢∫Ë™ç&lt;/h2&gt;</span>

<span class="s2">        &lt;p&gt;„Åì„Çì„Å´„Å°„ÅØÔºÅ&lt;/p&gt;</span>

<span class="s2">        &lt;p&gt;‰∏ãË®ò„ÅÆ„É™„É≥„ÇØÂÖà„Çà„Çä„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂ§âÊõ¥„Åó„Å¶„ÄÅÁôªÈå≤„ÇíÂÆå‰∫Ü„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö&lt;/p&gt;</span>

<span class="s2">        &lt;div style=&quot;background-color: #fff3cd; padding: 15px; border-radius: 4px; margin: 20px 0; border-left: 4px solid #ffc107;&quot;&gt;</span>
<span class="s2">            &lt;p style=&quot;margin: 0; font-weight: bold; color: #856404;&quot;&gt;</span>
<span class="s2">                ÂàùÊúü„Éë„Çπ„ÉØ„Éº„ÉâÔºötemp_password_123</span>
<span class="s2">            &lt;/p&gt;</span>
<span class="s2">        &lt;/div&gt;</span>

<span class="s2">        &lt;div style=&quot;text-align: center; margin: 30px 0;&quot;&gt;</span>
<span class="s2">            &lt;a href=&quot;</span><span class="si">{</span><span class="n">verification_url</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="s2">               style=&quot;background-color: #3498db; color: white; padding: 12px 24px;</span>
<span class="s2">                      text-decoration: none; border-radius: 4px; display: inline-block;</span>
<span class="s2">                      font-weight: bold;&quot;&gt;„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÇíÁ¢∫Ë™ç„Åô„Çã&lt;/a&gt;</span>
<span class="s2">        &lt;/div&gt;</span>

<span class="s2">        &lt;p&gt;„Åæ„Åü„ÅØ„ÄÅ‰ª•‰∏ã„ÅÆURL„Çí„Ç≥„Éî„Éº„Åó„Å¶&lt;br&gt;</span>
<span class="s2">        „Éñ„É©„Ç¶„Ç∂„ÅÆ„Ç¢„Éâ„É¨„Çπ„Éê„Éº„Å´Ë≤º„Çä‰ªò„Åë„Å¶„Åè„Å†„Åï„ÅÑÔºö&lt;/p&gt;</span>

<span class="s2">        &lt;div style=&quot;background-color: #f8f9fa; padding: 15px; border-radius: 4px; margin: 20px 0;&quot;&gt;</span>
<span class="s2">            &lt;p style=&quot;word-break: break-all; font-family: monospace; margin: 0; font-size: 12px;&quot;&gt;</span>
<span class="s2">                </span><span class="si">{</span><span class="n">verification_url</span><span class="si">}</span>
<span class="s2">            &lt;/p&gt;</span>
<span class="s2">        &lt;/div&gt;</span>

<span class="s2">        &lt;p&gt;„Åî‰∏çÊòé„Å™ÁÇπ„Åå„Åî„Åñ„ÅÑ„Åæ„Åó„Åü„Çâ„ÄÅ&lt;br&gt;</span>
<span class="s2">        „ÅäÊ∞óËªΩ„Å´„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ„ÄÇ&lt;/p&gt;</span>

<span class="s2">        &lt;p style=&quot;margin-top: 30px;&quot;&gt;</span>
<span class="s2">            &lt;small style=&quot;background-color: #fff3cd; padding: 5px 10px; border-radius: 3px; color: #856404;&quot;&gt;</span>
<span class="s2">                ‚è∞ „Åì„ÅÆ„É™„É≥„ÇØ„ÅÆÊúâÂäπÊôÇÈñì„ÅØ1ÊôÇÈñì„Åß„Åô„ÄÇ</span>
<span class="s2">            &lt;/small&gt;</span>
<span class="s2">        &lt;/p&gt;</span>

<span class="s2">        &lt;hr style=&quot;border: none; border-top: 1px solid #eee; margin: 30px 0;&quot;&gt;</span>

<span class="s2">        &lt;p style=&quot;color: #666; font-size: 12px; text-align: center;&quot;&gt;</span>
<span class="s2">            „Çà„Çç„Åó„Åè„ÅäÈ°ò„ÅÑ„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ&lt;br&gt;&lt;br&gt;</span>
<span class="s2">            &lt;strong&gt;Blog API „ÉÅ„Éº„É†&lt;/strong&gt;</span>
<span class="s2">        &lt;/p&gt;</span>
<span class="s2">    &lt;/div&gt;</span>
<span class="s2">&lt;/body&gt;</span>
<span class="s2">&lt;/html&gt;&quot;&quot;&quot;</span>

        <span class="n">PREFER_PLAIN_TEXT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;PREFER_PLAIN_TEXT_EMAIL&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span>
        <span class="k">if</span> <span class="n">PREFER_PLAIN_TEXT</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">MessageSchema</span><span class="p">(</span>
                <span class="n">subject</span><span class="o">=</span><span class="s2">&quot;„ÄêBlog API„Äë„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅÆÁ¢∫Ë™ç&quot;</span><span class="p">,</span>
                <span class="n">recipients</span><span class="o">=</span><span class="p">[</span><span class="n">email</span><span class="p">],</span>
                <span class="n">body</span><span class="o">=</span><span class="n">plain_body</span><span class="p">,</span>
                <span class="n">subtype</span><span class="o">=</span><span class="n">MessageType</span><span class="o">.</span><span class="n">plain</span><span class="p">,</span>
                <span class="n">charset</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">MessageSchema</span><span class="p">(</span>
                <span class="n">subject</span><span class="o">=</span><span class="s2">&quot;„ÄêBlog API„Äë„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅÆÁ¢∫Ë™ç&quot;</span><span class="p">,</span>
                <span class="n">recipients</span><span class="o">=</span><span class="p">[</span><span class="n">email</span><span class="p">],</span>
                <span class="n">body</span><span class="o">=</span><span class="n">html_body</span><span class="p">,</span>
                <span class="n">subtype</span><span class="o">=</span><span class="n">MessageType</span><span class="o">.</span><span class="n">html</span><span class="p">,</span>
                <span class="n">charset</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span>
            <span class="p">)</span>
        <span class="n">fm</span> <span class="o">=</span> <span class="n">FastMail</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">fm</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="n">create_logger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Á¢∫Ë™ç„É°„Éº„É´„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü: </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">create_error_logger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;„É°„Éº„É´ÈÄÅ‰ø°„Ç®„É©„Éº: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">_print_dev_mode_email</span><span class="p">(</span>
            <span class="s2">&quot;„É°„Éº„É´ÈÄÅ‰ø°Ôºà„Ç®„É©„ÉºÁô∫Áîü - ÈñãÁô∫„É¢„Éº„ÉâÔºâ&quot;</span><span class="p">,</span>
            <span class="n">email</span><span class="p">,</span>
            <span class="s2">&quot;„Äê„Éñ„É≠„Ç∞„Çµ„Éº„Éì„ÇπÊú¨‰∫∫Á¢∫Ë™ç„Äë„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÅÆÁ¢∫Ë™ç&quot;</span><span class="p">,</span>
            <span class="n">content</span><span class="p">,</span>
            <span class="n">verification_url</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="send_registration_complete_email">
<a class="viewcode-back" href="../../utils.email_sender.html#utils.email_sender.send_registration_complete_email">[docs]</a>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_registration_complete_email</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ÁôªÈå≤ÂÆå‰∫Ü„É°„Éº„É´„ÇíÈÄÅ‰ø°„Åô„Çã&quot;&quot;&quot;</span>
    <span class="n">create_logger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ÁôªÈå≤ÂÆå‰∫Ü„É°„Éº„É´ÈÄÅ‰ø°ÈñãÂßã - ÂÆõÂÖà: </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2">, „É¶„Éº„Ç∂„ÉºÂêç: </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;„Åì„Çì„Å´„Å°„ÅØ„ÄÅ</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">„Åï„ÇìÔºÅ</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Blog API„Å∏„ÅÆ„ÅîÁôªÈå≤„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇüéâ</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;„Åì„Çå„Åã„ÇâBlog API„ÅÆÂÖ®„Å¶„ÅÆÊ©üËÉΩ„Çí„Åä‰Ωø„ÅÑ„ÅÑ„Åü„Å†„Åë„Åæ„ÅôÔºö</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;‚Ä¢ „Éñ„É≠„Ç∞Ë®ò‰∫ã„ÅÆ‰ΩúÊàê„ÉªÁ∑®ÈõÜ„ÉªÂâäÈô§</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;‚Ä¢ „Ç≥„É°„É≥„Éà„ÅÆÊäïÁ®ø„ÉªÁÆ°ÁêÜ</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;‚Ä¢ „Éó„É≠„Éï„Ç£„Éº„É´„ÅÆÁÆ°ÁêÜ</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;‚Ä¢ „Åù„ÅÆ‰ªñ„ÅÆ‰æøÂà©„Å™Ê©üËÉΩ</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;„ÅîÂà©Áî®„ÅÑ„Åü„Å†„Åç„ÄÅ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;‰Ωï„Åã„Åî‰∏çÊòé„Å™ÁÇπ„Åå„Åî„Åñ„ÅÑ„Åæ„Åó„Åü„Çâ„ÄÅ„ÅäÊ∞óËªΩ„Å´„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ„ÄÇ</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Blog API „ÉÅ„Éº„É†&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_email_enabled</span><span class="p">():</span>
        <span class="n">create_logger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ÈñãÁô∫„É¢„Éº„Éâ] ÁôªÈå≤ÂÆå‰∫Ü„É°„Éº„É´ÊÉÖÂ†±„Çí„Ç≥„É≥„ÇΩ„Éº„É´„Å´Âá∫Âäõ: </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">_print_dev_mode_email</span><span class="p">(</span>
            <span class="s2">&quot;ÁôªÈå≤ÂÆå‰∫Ü„É°„Éº„É´ÈÄÅ‰ø°ÔºàÈñãÁô∫„É¢„Éº„ÉâÔºâ&quot;</span><span class="p">,</span>
            <span class="n">email</span><span class="p">,</span>
            <span class="s2">&quot;„ÄêBlog API„ÄëÁôªÈå≤ÂÆå‰∫Ü„ÅÆ„ÅäÁü•„Çâ„Åõ&quot;</span><span class="p">,</span>
            <span class="n">content</span>
        <span class="p">)</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_validate_mail_config</span><span class="p">():</span>
        <span class="n">create_error_logger</span><span class="p">(</span><span class="s2">&quot;„É°„Éº„É´Ë®≠ÂÆö„Åå‰∏çÂÆåÂÖ®„Åß„Åô„ÄÇÈñãÁô∫„É¢„Éº„Éâ„Åß„Ç≥„É≥„ÇΩ„Éº„É´Âá∫Âäõ„Åó„Åæ„Åô„ÄÇ&quot;</span><span class="p">)</span>
        <span class="n">_print_dev_mode_email</span><span class="p">(</span>
            <span class="s2">&quot;ÁôªÈå≤ÂÆå‰∫Ü„É°„Éº„É´ÈÄÅ‰ø°ÔºàÈñãÁô∫„É¢„Éº„Éâ - Ë®≠ÂÆö‰∏çÂÆåÂÖ®Ôºâ&quot;</span><span class="p">,</span>
            <span class="n">email</span><span class="p">,</span>
            <span class="s2">&quot;„ÄêBlog API„ÄëÁôªÈå≤ÂÆå‰∫Ü„ÅÆ„ÅäÁü•„Çâ„Åõ&quot;</span><span class="p">,</span>
            <span class="n">content</span>
        <span class="p">)</span>
        <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="n">get_mail_config</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">conf</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;„É°„Éº„É´Ë®≠ÂÆö„ÅåÊ≠£„Åó„ÅèË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì&quot;</span><span class="p">)</span>
        <span class="c1"># „Éó„É¨„Éº„É≥„ÉÜ„Ç≠„Çπ„Éà„É°„Éº„É´</span>
        <span class="n">plain_body</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># HTML„É°„Éº„É´</span>
        <span class="n">html_body</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;!DOCTYPE html&gt;</span>
<span class="s2">&lt;html&gt;</span>
<span class="s2">&lt;head&gt;</span>
<span class="s2">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span>
<span class="s2">    &lt;title&gt;ÁôªÈå≤ÂÆå‰∫Ü„ÅÆ„ÅäÁü•„Çâ„Åõ&lt;/title&gt;</span>
<span class="s2">&lt;/head&gt;</span>
<span class="s2">&lt;body style=&quot;font-family: Arial, sans-serif; line-height: 1.6; color: #333;&quot;&gt;</span>
<span class="s2">    &lt;div style=&quot;max-width: 600px; margin: 0 auto; padding: 20px;&quot;&gt;</span>
<span class="s2">        &lt;div style=&quot;text-align: center; margin-bottom: 30px;&quot;&gt;</span>
<span class="s2">            &lt;h1 style=&quot;color: #27ae60; margin: 0;&quot;&gt;üéâ ÁôªÈå≤ÂÆå‰∫ÜÔºÅ&lt;/h1&gt;</span>
<span class="s2">        &lt;/div&gt;</span>

<span class="s2">        &lt;h2 style=&quot;color: #2c3e50;&quot;&gt;„Åì„Çì„Å´„Å°„ÅØ„ÄÅ</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">„Åï„ÇìÔºÅ&lt;/h2&gt;</span>

<span class="s2">        &lt;p style=&quot;font-size: 16px; color: #27ae60; font-weight: bold;&quot;&gt;</span>
<span class="s2">            Blog API„Å∏„ÅÆ„ÅîÁôªÈå≤„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇüéâ</span>
<span class="s2">        &lt;/p&gt;</span>

<span class="s2">        &lt;p&gt;„Åì„Çå„Åã„ÇâBlog API„ÅÆÂÖ®„Å¶„ÅÆÊ©üËÉΩ„Çí„Åä‰Ωø„ÅÑ„ÅÑ„Åü„Å†„Åë„Åæ„ÅôÔºö&lt;/p&gt;</span>

<span class="s2">        &lt;ul style=&quot;background-color: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;&quot;&gt;</span>
<span class="s2">            &lt;li style=&quot;margin: 8px 0;&quot;&gt;üìù „Éñ„É≠„Ç∞Ë®ò‰∫ã„ÅÆ‰ΩúÊàê„ÉªÁ∑®ÈõÜ„ÉªÂâäÈô§&lt;/li&gt;</span>
<span class="s2">            &lt;li style=&quot;margin: 8px 0;&quot;&gt;üí¨ „Ç≥„É°„É≥„Éà„ÅÆÊäïÁ®ø„ÉªÁÆ°ÁêÜ&lt;/li&gt;</span>
<span class="s2">            &lt;li style=&quot;margin: 8px 0;&quot;&gt;üë§ „Éó„É≠„Éï„Ç£„Éº„É´„ÅÆÁÆ°ÁêÜ&lt;/li&gt;</span>
<span class="s2">            &lt;li style=&quot;margin: 8px 0;&quot;&gt;‚ö° „Åù„ÅÆ‰ªñ„ÅÆ‰æøÂà©„Å™Ê©üËÉΩ&lt;/li&gt;</span>
<span class="s2">        &lt;/ul&gt;</span>

<span class="s2">        &lt;div style=&quot;background-color: #e8f5e8; padding: 20px; border-radius: 8px; border-left: 4px solid #27ae60; margin: 30px 0;&quot;&gt;</span>
<span class="s2">            &lt;p style=&quot;margin: 0; color: #2d5a2d;&quot;&gt;</span>
<span class="s2">                &lt;strong&gt;„ÅîÂà©Áî®„ÅÑ„Åü„Å†„Åç„ÄÅ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ&lt;/strong&gt;&lt;br&gt;</span>
<span class="s2">                ‰Ωï„Åã„Åî‰∏çÊòé„Å™ÁÇπ„Åå„Åî„Åñ„ÅÑ„Åæ„Åó„Åü„Çâ„ÄÅ„ÅäÊ∞óËªΩ„Å´„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ„ÄÇ</span>
<span class="s2">            &lt;/p&gt;</span>
<span class="s2">        &lt;/div&gt;</span>

<span class="s2">        &lt;hr style=&quot;border: none; border-top: 1px solid #eee; margin: 30px 0;&quot;&gt;</span>

<span class="s2">        &lt;p style=&quot;color: #666; font-size: 12px; text-align: center;&quot;&gt;</span>
<span class="s2">            ‰ªäÂæå„Å®„ÇÇ„Çà„Çç„Åó„Åè„ÅäÈ°ò„ÅÑ„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ&lt;br&gt;&lt;br&gt;</span>
<span class="s2">            &lt;strong&gt;Blog API „ÉÅ„Éº„É†&lt;/strong&gt;</span>
<span class="s2">        &lt;/p&gt;</span>
<span class="s2">    &lt;/div&gt;</span>
<span class="s2">&lt;/body&gt;</span>
<span class="s2">&lt;/html&gt;&quot;&quot;&quot;</span>

        <span class="n">PREFER_PLAIN_TEXT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;PREFER_PLAIN_TEXT_EMAIL&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span>
        <span class="k">if</span> <span class="n">PREFER_PLAIN_TEXT</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">MessageSchema</span><span class="p">(</span>
                <span class="n">subject</span><span class="o">=</span><span class="s2">&quot;„ÄêBlog API„ÄëÁôªÈå≤ÂÆå‰∫Ü„ÅÆ„ÅäÁü•„Çâ„Åõ&quot;</span><span class="p">,</span>
                <span class="n">recipients</span><span class="o">=</span><span class="p">[</span><span class="n">email</span><span class="p">],</span>
                <span class="n">body</span><span class="o">=</span><span class="n">plain_body</span><span class="p">,</span>
                <span class="n">subtype</span><span class="o">=</span><span class="n">MessageType</span><span class="o">.</span><span class="n">plain</span><span class="p">,</span>
                <span class="n">charset</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">MessageSchema</span><span class="p">(</span>
                <span class="n">subject</span><span class="o">=</span><span class="s2">&quot;„ÄêBlog API„ÄëÁôªÈå≤ÂÆå‰∫Ü„ÅÆ„ÅäÁü•„Çâ„Åõ&quot;</span><span class="p">,</span>
                <span class="n">recipients</span><span class="o">=</span><span class="p">[</span><span class="n">email</span><span class="p">],</span>
                <span class="n">body</span><span class="o">=</span><span class="n">html_body</span><span class="p">,</span>
                <span class="n">subtype</span><span class="o">=</span><span class="n">MessageType</span><span class="o">.</span><span class="n">html</span><span class="p">,</span>
                <span class="n">charset</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span>
            <span class="p">)</span>
        <span class="c1"># „É°„Éº„É´ÈÄÅ‰ø°</span>
        <span class="n">fm</span> <span class="o">=</span> <span class="n">FastMail</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">fm</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="n">create_logger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ÁôªÈå≤ÂÆå‰∫Ü„É°„Éº„É´„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü: </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">create_error_logger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ÁôªÈå≤ÂÆå‰∫Ü„É°„Éº„É´ÈÄÅ‰ø°„Ç®„É©„Éº: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">_print_dev_mode_email</span><span class="p">(</span>
            <span class="s2">&quot;ÁôªÈå≤ÂÆå‰∫Ü„É°„Éº„É´ÈÄÅ‰ø°Ôºà„Ç®„É©„ÉºÁô∫Áîü - ÈñãÁô∫„É¢„Éº„ÉâÔºâ&quot;</span><span class="p">,</span>
            <span class="n">email</span><span class="p">,</span>
            <span class="s2">&quot;„ÄêBlog API„ÄëÁôªÈå≤ÂÆå‰∫Ü„ÅÆ„ÅäÁü•„Çâ„Åõ&quot;</span><span class="p">,</span>
            <span class="n">content</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="send_account_deletion_email">
<a class="viewcode-back" href="../../utils.email_sender.html#utils.email_sender.send_account_deletion_email">[docs]</a>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_account_deletion_email</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ÈÄÄ‰ºöÂÆå‰∫Ü„É°„Éº„É´„ÇíÈÄÅ‰ø°„Åô„Çã&quot;&quot;&quot;</span>
    <span class="n">create_logger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ÈÄÄ‰ºöÂÆå‰∫Ü„É°„Éº„É´ÈÄÅ‰ø°ÈñãÂßã - ÂÆõÂÖà: </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2">, „É¶„Éº„Ç∂„ÉºÂêç: </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;„Åì„Çì„Å´„Å°„ÅØ„ÄÅ</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">„Åï„Çì</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Blog API„Åã„Çâ„ÅÆÈÄÄ‰ºöÊâãÁ∂ö„Åç„ÅåÂÆå‰∫Ü„ÅÑ„Åü„Åó„Åæ„Åó„Åü„ÄÇ</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;„Åì„Çå„Åæ„ÅßBlog API„Çí„ÅîÂà©Áî®„ÅÑ„Åü„Å†„Åç„ÄÅË™†„Å´„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åó„Åü„ÄÇ</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;„ÅäÂÆ¢Êßò„ÅÆÊäïÁ®ø„Åï„Çå„ÅüË®ò‰∫ã„ÇÑ„Éá„Éº„Çø„ÅØ„ÄÅ„ÅîË¶ÅÊúõ„Å´Âæì„Å£„Å¶ÂâäÈô§„Åï„Åõ„Å¶„ÅÑ„Åü„Å†„Åç„Åæ„Åó„Åü„ÄÇ</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;ÈÄÄ‰ºö„Å´Èñ¢„Åô„ÇãË©≥Á¥∞Ôºö</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;‚Ä¢ „É¶„Éº„Ç∂„Éº„Ç¢„Ç´„Ç¶„É≥„Éà„ÅÆÂâäÈô§</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;‚Ä¢ ÊäïÁ®ø„Åï„Çå„ÅüË®ò‰∫ã„ÅÆÂâäÈô§</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;‚Ä¢ ÂÄã‰∫∫ÊÉÖÂ†±„ÅÆÂâäÈô§</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;„Åæ„Åü‰Ωï„Åã„ÅÆÊ©ü‰ºö„Åå„Åî„Åñ„ÅÑ„Åæ„Åó„Åü„Çâ„ÄÅ„ÅÑ„Å§„Åß„ÇÇ„ÅäÊ∞óËªΩ„Å´„ÅîÂà©Áî®„Åè„Å†„Åï„ÅÑ„ÄÇ</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Êñ∞Ë¶èÁôªÈå≤„ÅØ„ÅÑ„Å§„Åß„ÇÇÂèØËÉΩ„Åß„Åô„ÄÇ</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;‰ªäÂæå„Å®„ÇÇ„Çà„Çç„Åó„Åè„ÅäÈ°ò„ÅÑ„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Blog API „ÉÅ„Éº„É†&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_email_enabled</span><span class="p">():</span>
        <span class="n">create_logger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ÈñãÁô∫„É¢„Éº„Éâ] ÈÄÄ‰ºöÂÆå‰∫Ü„É°„Éº„É´ÊÉÖÂ†±„Çí„Ç≥„É≥„ÇΩ„Éº„É´„Å´Âá∫Âäõ: </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">_print_dev_mode_email</span><span class="p">(</span>
            <span class="s2">&quot;ÈÄÄ‰ºöÂÆå‰∫Ü„É°„Éº„É´ÈÄÅ‰ø°ÔºàÈñãÁô∫„É¢„Éº„ÉâÔºâ&quot;</span><span class="p">,</span>
            <span class="n">email</span><span class="p">,</span>
            <span class="s2">&quot;„ÄêBlog API„ÄëÈÄÄ‰ºöÂÆå‰∫Ü„ÅÆ„ÅäÁü•„Çâ„Åõ&quot;</span><span class="p">,</span>
            <span class="n">content</span>
        <span class="p">)</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_validate_mail_config</span><span class="p">():</span>
        <span class="n">create_error_logger</span><span class="p">(</span><span class="s2">&quot;„É°„Éº„É´Ë®≠ÂÆö„Åå‰∏çÂÆåÂÖ®„Åß„Åô„ÄÇÈñãÁô∫„É¢„Éº„Éâ„Åß„Ç≥„É≥„ÇΩ„Éº„É´Âá∫Âäõ„Åó„Åæ„Åô„ÄÇ&quot;</span><span class="p">)</span>
        <span class="n">_print_dev_mode_email</span><span class="p">(</span>
            <span class="s2">&quot;ÈÄÄ‰ºöÂÆå‰∫Ü„É°„Éº„É´ÈÄÅ‰ø°ÔºàÈñãÁô∫„É¢„Éº„Éâ - Ë®≠ÂÆö‰∏çÂÆåÂÖ®Ôºâ&quot;</span><span class="p">,</span>
            <span class="n">email</span><span class="p">,</span>
            <span class="s2">&quot;„ÄêBlog API„ÄëÈÄÄ‰ºöÂÆå‰∫Ü„ÅÆ„ÅäÁü•„Çâ„Åõ&quot;</span><span class="p">,</span>
            <span class="n">content</span>
        <span class="p">)</span>
        <span class="k">return</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="n">get_mail_config</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">conf</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;„É°„Éº„É´Ë®≠ÂÆö„ÅåÊ≠£„Åó„ÅèË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì&quot;</span><span class="p">)</span>
        <span class="c1"># „Éó„É¨„Éº„É≥„ÉÜ„Ç≠„Çπ„Éà„É°„Éº„É´</span>
        <span class="n">plain_body</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># HTML„É°„Éº„É´</span>
        <span class="n">html_body</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;!DOCTYPE html&gt;</span>
<span class="s2">&lt;html&gt;</span>
<span class="s2">&lt;head&gt;</span>
<span class="s2">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span>
<span class="s2">    &lt;title&gt;ÈÄÄ‰ºöÂÆå‰∫Ü„ÅÆ„ÅäÁü•„Çâ„Åõ&lt;/title&gt;</span>
<span class="s2">&lt;/head&gt;</span>
<span class="s2">&lt;body style=&quot;font-family: Arial, sans-serif; line-height: 1.6; color: #333;&quot;&gt;</span>
<span class="s2">    &lt;div style=&quot;max-width: 600px; margin: 0 auto; padding: 20px;&quot;&gt;</span>
<span class="s2">        &lt;div style=&quot;text-align: center; margin-bottom: 30px;&quot;&gt;</span>
<span class="s2">            &lt;h1 style=&quot;color: #e74c3c; margin: 0;&quot;&gt;üëã ÈÄÄ‰ºöÂÆå‰∫Ü&lt;/h1&gt;</span>
<span class="s2">        &lt;/div&gt;</span>

<span class="s2">        &lt;h2 style=&quot;color: #2c3e50;&quot;&gt;„Åì„Çì„Å´„Å°„ÅØ„ÄÅ</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">„Åï„Çì&lt;/h2&gt;</span>

<span class="s2">        &lt;p style=&quot;font-size: 16px; color: #e74c3c; font-weight: bold;&quot;&gt;</span>
<span class="s2">            Blog API„Åã„Çâ„ÅÆÈÄÄ‰ºöÊâãÁ∂ö„Åç„ÅåÂÆå‰∫Ü„ÅÑ„Åü„Åó„Åæ„Åó„Åü„ÄÇ</span>
<span class="s2">        &lt;/p&gt;</span>

<span class="s2">        &lt;p&gt;„Åì„Çå„Åæ„ÅßBlog API„Çí„ÅîÂà©Áî®„ÅÑ„Åü„Å†„Åç„ÄÅË™†„Å´„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åó„Åü„ÄÇ&lt;/p&gt;</span>
<span class="s2">        &lt;p&gt;„ÅäÂÆ¢Êßò„ÅÆÊäïÁ®ø„Åï„Çå„ÅüË®ò‰∫ã„ÇÑ„Éá„Éº„Çø„ÅØ„ÄÅ„ÅîË¶ÅÊúõ„Å´Âæì„Å£„Å¶ÂâäÈô§„Åï„Åõ„Å¶„ÅÑ„Åü„Å†„Åç„Åæ„Åó„Åü„ÄÇ&lt;/p&gt;</span>

<span class="s2">        &lt;div style=&quot;background-color: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;&quot;&gt;</span>
<span class="s2">            &lt;h3 style=&quot;color: #2c3e50; margin-top: 0;&quot;&gt;ÈÄÄ‰ºö„Å´Èñ¢„Åô„ÇãË©≥Á¥∞Ôºö&lt;/h3&gt;</span>
<span class="s2">            &lt;ul style=&quot;margin: 0;&quot;&gt;</span>
<span class="s2">                &lt;li style=&quot;margin: 8px 0;&quot;&gt;‚úÖ „É¶„Éº„Ç∂„Éº„Ç¢„Ç´„Ç¶„É≥„Éà„ÅÆÂâäÈô§&lt;/li&gt;</span>
<span class="s2">                &lt;li style=&quot;margin: 8px 0;&quot;&gt;‚úÖ ÊäïÁ®ø„Åï„Çå„ÅüË®ò‰∫ã„ÅÆÂâäÈô§&lt;/li&gt;</span>
<span class="s2">                &lt;li style=&quot;margin: 8px 0;&quot;&gt;‚úÖ ÂÄã‰∫∫ÊÉÖÂ†±„ÅÆÂâäÈô§&lt;/li&gt;</span>
<span class="s2">            &lt;/ul&gt;</span>
<span class="s2">        &lt;/div&gt;</span>

<span class="s2">        &lt;div style=&quot;background-color: #e8f5e8; padding: 20px; border-radius: 8px; border-left: 4px solid #27ae60; margin: 30px 0;&quot;&gt;</span>
<span class="s2">            &lt;p style=&quot;margin: 0; color: #2d5a2d;&quot;&gt;</span>
<span class="s2">                &lt;strong&gt;„Åæ„Åü‰Ωï„Åã„ÅÆÊ©ü‰ºö„Åå„Åî„Åñ„ÅÑ„Åæ„Åó„Åü„Çâ„ÄÅ„ÅÑ„Å§„Åß„ÇÇ„ÅäÊ∞óËªΩ„Å´„ÅîÂà©Áî®„Åè„Å†„Åï„ÅÑ„ÄÇ&lt;/strong&gt;&lt;br&gt;</span>
<span class="s2">                Êñ∞Ë¶èÁôªÈå≤„ÅØ„ÅÑ„Å§„Åß„ÇÇÂèØËÉΩ„Åß„Åô„ÄÇ</span>
<span class="s2">            &lt;/p&gt;</span>
<span class="s2">        &lt;/div&gt;</span>

<span class="s2">        &lt;hr style=&quot;border: none; border-top: 1px solid #eee; margin: 30px 0;&quot;&gt;</span>

<span class="s2">        &lt;p style=&quot;color: #666; font-size: 12px; text-align: center;&quot;&gt;</span>
<span class="s2">            ‰ªäÂæå„Å®„ÇÇ„Çà„Çç„Åó„Åè„ÅäÈ°ò„ÅÑ„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ&lt;br&gt;&lt;br&gt;</span>
<span class="s2">            &lt;strong&gt;Blog API „ÉÅ„Éº„É†&lt;/strong&gt;</span>
<span class="s2">        &lt;/p&gt;</span>
<span class="s2">    &lt;/div&gt;</span>
<span class="s2">&lt;/body&gt;</span>
<span class="s2">&lt;/html&gt;&quot;&quot;&quot;</span>

        <span class="n">PREFER_PLAIN_TEXT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;PREFER_PLAIN_TEXT_EMAIL&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span>
        <span class="k">if</span> <span class="n">PREFER_PLAIN_TEXT</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">MessageSchema</span><span class="p">(</span>
                <span class="n">subject</span><span class="o">=</span><span class="s2">&quot;„ÄêBlog API„ÄëÈÄÄ‰ºöÂÆå‰∫Ü„ÅÆ„ÅäÁü•„Çâ„Åõ&quot;</span><span class="p">,</span>
                <span class="n">recipients</span><span class="o">=</span><span class="p">[</span><span class="n">email</span><span class="p">],</span>
                <span class="n">body</span><span class="o">=</span><span class="n">plain_body</span><span class="p">,</span>
                <span class="n">subtype</span><span class="o">=</span><span class="n">MessageType</span><span class="o">.</span><span class="n">plain</span><span class="p">,</span>
                <span class="n">charset</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">MessageSchema</span><span class="p">(</span>
                <span class="n">subject</span><span class="o">=</span><span class="s2">&quot;„ÄêBlog API„ÄëÈÄÄ‰ºöÂÆå‰∫Ü„ÅÆ„ÅäÁü•„Çâ„Åõ&quot;</span><span class="p">,</span>
                <span class="n">recipients</span><span class="o">=</span><span class="p">[</span><span class="n">email</span><span class="p">],</span>
                <span class="n">body</span><span class="o">=</span><span class="n">html_body</span><span class="p">,</span>
                <span class="n">subtype</span><span class="o">=</span><span class="n">MessageType</span><span class="o">.</span><span class="n">html</span><span class="p">,</span>
                <span class="n">charset</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span>
            <span class="p">)</span>
        <span class="c1"># „É°„Éº„É´ÈÄÅ‰ø°</span>
        <span class="n">fm</span> <span class="o">=</span> <span class="n">FastMail</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">fm</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="n">create_logger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ÈÄÄ‰ºöÂÆå‰∫Ü„É°„Éº„É´„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü: </span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">create_error_logger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ÈÄÄ‰ºöÂÆå‰∫Ü„É°„Éº„É´ÈÄÅ‰ø°„Ç®„É©„Éº: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">_print_dev_mode_email</span><span class="p">(</span>
            <span class="s2">&quot;ÈÄÄ‰ºöÂÆå‰∫Ü„É°„Éº„É´ÈÄÅ‰ø°Ôºà„Ç®„É©„ÉºÁô∫Áîü - ÈñãÁô∫„É¢„Éº„ÉâÔºâ&quot;</span><span class="p">,</span>
            <span class="n">email</span><span class="p">,</span>
            <span class="s2">&quot;„ÄêBlog API„ÄëÈÄÄ‰ºöÂÆå‰∫Ü„ÅÆ„ÅäÁü•„Çâ„Åõ&quot;</span><span class="p">,</span>
            <span class="n">content</span>
        <span class="p">)</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">blog-api-main</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../custom_token.html">custom_token module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../database.html">database module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generate_summary_report.html">generate_summary_report module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hashing.html">hashing module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../logger.html">logger package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../main.html">main module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../models.html">models module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../oauth2.html">oauth2 module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../routers.html">routers package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../run_continuous_tests.html">run_continuous_tests module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../schemas.html">schemas module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tests.html">tests package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../update_main_bug_history.html">update_main_bug_history module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../utils.html">utils package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Author.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>
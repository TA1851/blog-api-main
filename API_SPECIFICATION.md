# Blog API パブリックエンドポイント仕様書

## 概要

ブログ記事の認証なしでの閲覧を可能にするパブリックAPIエンドポイントの仕様書です。
日本語検索機能、Markdown→HTML変換、ページネーション機能を提供します。

## ベースURL

```
http://localhost:8000/api/v1
```

## 共通レスポンス仕様

### 成功時のレスポンス形式

```json
[
  {
    "article_id": 1,
    "title": "記事のタイトル",
    "body_html": "<h1>見出し</h1><p>本文内容<br>改行も含まれます</p>"
  }
]
```

### エラー時のレスポンス形式

```json
{
  "detail": "エラーメッセージ"
}
```

---

## エンドポイント一覧

### 1. パブリック記事一覧取得

**エンドポイント:** `GET /public/articles`

**概要:** 認証なしで全ての記事を取得します。ページネーション機能付き。

#### リクエストパラメータ

| パラメータ | 型 | 必須 | デフォルト | 説明 |
|-----------|---|-----|----------|-----|
| `limit` | integer | No | なし | 取得する最大記事数（1以上）。指定しない場合は全件取得 |
| `skip` | integer | No | 0 | スキップする記事数（0以上）。ページネーション用 |

#### レスポンス

**ステータスコード:** `200 OK`

**レスポンスボディ:**

```json
[
  {
    "article_id": 3,
    "title": "最新の記事",
    "body_html": "<h2>見出し2</h2><p>最新記事の内容です。<br>改行も正しく表示されます。</p>"
  },
  {
    "article_id": 2,
    "title": "2番目の記事", 
    "body_html": "<p>記事の本文がここに表示されます。</p>"
  },
  {
    "article_id": 1,
    "title": "最初の記事",
    "body_html": "<p>最初に投稿された記事です。</p>"
  }
]
```

#### 使用例

```bash
# 全記事を取得
curl "http://localhost:8000/api/v1/public/articles"

# 最新5件を取得
curl "http://localhost:8000/api/v1/public/articles?limit=5"

# 6件目から10件目を取得（ページネーション）
curl "http://localhost:8000/api/v1/public/articles?skip=5&limit=5"
```

---

### 2. パブリック記事詳細取得

**エンドポイント:** `GET /public/articles/{article_id}`

**概要:** 指定されたIDの記事詳細を認証なしで取得します。

#### パスパラメータ

| パラメータ | 型 | 必須 | 説明 |
|-----------|---|-----|-----|
| `article_id` | integer | Yes | 取得する記事のID |

#### レスポンス

**ステータスコード:** `200 OK`

**レスポンスボディ:**

```json
{
  "article_id": 1,
  "title": "記事のタイトル",
  "body_html": "<h1>見出し1</h1><p>記事の詳細な内容がここに表示されます。<br>改行も正しく反映されます。</p><h2>サブ見出し</h2><p>さらなる詳細内容...</p>"
}
```

#### エラーレスポンス

**ステータスコード:** `404 Not Found` - 記事が存在しない場合

```json
{
  "detail": "記事ID 999 の記事が見つかりません"
}
```

#### 使用例

```bash
# 記事ID 1の詳細を取得
curl "http://localhost:8000/api/v1/public/articles/1"

# 記事ID 5の詳細を取得
curl "http://localhost:8000/api/v1/public/articles/5"
```

---

### 3. パブリック記事検索

**エンドポイント:** `GET /public/articles/search`

**概要:** キーワードで記事を検索します。日本語検索対応、複数キーワードによるAND検索機能付き。

#### リクエストパラメータ

| パラメータ | 型 | 必須 | デフォルト | 説明 |
|-----------|---|-----|----------|-----|
| `q` | string | Yes | - | 検索キーワード（日本語・英語対応）。複数キーワードはスペース区切り |
| `limit` | integer | No | 10 | 取得する最大記事数（1-100） |
| `skip` | integer | No | 0 | スキップする記事数（0以上）。ページネーション用 |

#### レスポンス

**ステータスコード:** `200 OK`

**レスポンスボディ:**

```json
[
  {
    "article_id": 5,
    "title": "React開発の基礎",
    "body_html": "<h1>React開発</h1><p>React開発の基礎について説明します。<br>コンポーネントの作成方法を学びましょう。</p>"
  },
  {
    "article_id": 2,
    "title": "フロントエンド開発",
    "body_html": "<p>フロントエンド開発にはReactが人気です。</p>"
  }
]
```

#### 検索仕様

- **検索対象:** 記事のタイトル（`title`）と本文（`body`）
- **検索方式:** 部分一致検索（大文字小文字区別なし）
- **複数キーワード:** スペース区切りでAND検索
- **日本語対応:** URLエンコードされた日本語キーワードを自動デコード
- **ソート順:** 記事ID降順（新しい記事が先頭）

#### 使用例

```bash
# 単一キーワード検索
curl "http://localhost:8000/api/v1/public/articles/search?q=React"

# 複数キーワード検索（AND検索）
curl "http://localhost:8000/api/v1/public/articles/search?q=React%20%E9%96%8B%E7%99%BA"

# 日本語検索（URLエンコード）
curl "http://localhost:8000/api/v1/public/articles/search?q=%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89"

# ページネーション付き検索
curl "http://localhost:8000/api/v1/public/articles/search?q=開発&limit=5&skip=0"
```

---

## データモデル

### PublicArticle

パブリックAPIで返される記事データの構造

| フィールド | 型 | 説明 |
|-----------|---|-----|
| `article_id` | integer | 記事の一意識別子 |
| `title` | string | 記事のタイトル（最大30文字） |
| `body_html` | string | Markdown変換済みのHTML形式本文 |

#### 注意事項

- `body_html`フィールドには、元のMarkdown形式の本文が自動的にHTMLに変換されたものが含まれます
- 改行は`<br>`タグに変換されます
- Markdownの見出し（`#`）は適切なHTMLタグ（`<h1>`, `<h2>`など）に変換されます
- 元の`body`フィールド（Markdown形式）はパブリックAPIには含まれません

---

## エラーハンドリング

### エラーレスポンス

| ステータスコード | 説明 | 対処法 |
|-----------------|-----|-------|
| `400 Bad Request` | リクエストパラメータが不正 | パラメータの形式を確認 |
| `422 Unprocessable Entity` | バリデーションエラー | 必須パラメータや制約を確認 |
| `500 Internal Server Error` | サーバー内部エラー | しばらく時間をおいて再試行 |

### エラーレスポンス例

```json
{
  "detail": "記事の取得に失敗しました"
}
```

---

## セキュリティ考慮事項

### XSS対策

- `body_html`フィールドには信頼されたMarkdown変換結果が含まれますが、表示時には適切なサニタイズを行ってください
- ユーザー入力（検索キーワードなど）は適切にエスケープしてください

### CORS設定

現在の実装では適切なCORS設定がされていますが、本番環境では必要に応じて制限してください。

---

## まとめ

このAPIを使用することで、以下の機能を持つフロントエンドアプリケーションを構築できます：

1. **記事一覧表示**: ページネーション付きの記事リスト
2. **記事検索**: 日本語対応の高度な検索機能
3. **リッチコンテンツ**: Markdown形式の記事をHTML形式で表示
